import time

import slaythespire as sts

game_string = """
{"available_commands":["play","end","potion","key","click","wait","state"],"ready_for_command":true,"in_game":true,"game_state":{"screen_type":"NONE","screen_state":{},"seed":4615041493751475629,"combat_state":{"draw_pile":[{"exhausts":false,"is_playable":true,"cost":2,"name":"Bash","id":"Bash","type":"ATTACK","ethereal":false,"uuid":"fb455e09-94b8-4a48-89f8-1a7f0593a58f","upgrades":0,"rarity":"BASIC","has_target":true},{"exhausts":false,"is_playable":true,"cost":0,"name":"Flash of Steel+","id":"Flash of Steel","type":"ATTACK","ethereal":false,"uuid":"13d589dc-090c-4424-834c-6c35ba48dd2a","upgrades":1,"rarity":"UNCOMMON","has_target":true},{"exhausts":false,"is_playable":true,"cost":2,"name":"Perfected Strike+","id":"Perfected Strike","type":"ATTACK","ethereal":false,"uuid":"f021babd-f14c-4093-9acd-7a4a384dbf61","upgrades":1,"rarity":"COMMON","has_target":true},{"exhausts":false,"is_playable":true,"cost":1,"name":"Strike","id":"Strike_R","type":"ATTACK","ethereal":false,"uuid":"6233c009-ddcc-44a9-8065-620bdfc6691d","upgrades":0,"rarity":"BASIC","has_target":true},{"exhausts":false,"is_playable":true,"cost":1,"name":"Strike","id":"Strike_R","type":"ATTACK","ethereal":false,"uuid":"4dc838ae-dc4e-47ed-9604-04b0e755cd26","upgrades":0,"rarity":"BASIC","has_target":true},{"exhausts":false,"is_playable":true,"cost":2,"name":"Perfected Strike+","id":"Perfected Strike","type":"ATTACK","ethereal":false,"uuid":"3ecded1e-efbd-4cc8-9f6c-bb5d1640c6b6","upgrades":1,"rarity":"COMMON","has_target":true},{"exhausts":false,"is_playable":true,"cost":1,"name":"Defend","id":"Defend_R","type":"SKILL","ethereal":false,"uuid":"9032621c-04d4-4180-be5e-dacc27f92c76","upgrades":0,"rarity":"BASIC","has_target":false},{"exhausts":false,"is_playable":true,"cost":1,"name":"Strike","id":"Strike_R","type":"ATTACK","ethereal":false,"uuid":"0981fa04-8e90-4c41-a7c0-99ebff263a4e","upgrades":0,"rarity":"BASIC","has_target":true},{"exhausts":false,"is_playable":true,"cost":0,"name":"Flex","id":"Flex","type":"SKILL","ethereal":false,"uuid":"09dd7f6f-7c59-41be-9617-f063698d81ad","upgrades":0,"rarity":"COMMON","has_target":false}],"discard_pile":[{"exhausts":false,"is_playable":true,"cost":0,"name":"Shrug It Off+","id":"Shrug It Off","type":"SKILL","ethereal":false,"uuid":"e00eb1e0-d047-44a0-91f5-062ba1f15b3d","upgrades":1,"rarity":"COMMON","has_target":false},{"exhausts":false,"is_playable":true,"cost":0,"name":"Defend","id":"Defend_R","type":"SKILL","ethereal":false,"uuid":"9a1eac19-8262-411e-ae73-433ecf2e6050","upgrades":0,"rarity":"BASIC","has_target":false},{"exhausts":false,"is_playable":true,"cost":1,"name":"Shrug It Off+","id":"Shrug It Off","type":"SKILL","ethereal":false,"uuid":"e072eb0e-1f44-47a8-af06-b2a4e34cdf4e","upgrades":1,"rarity":"COMMON","has_target":false},{"exhausts":false,"is_playable":true,"cost":0,"name":"Thunderclap+","id":"Thunderclap","type":"ATTACK","ethereal":false,"uuid":"dcb90d78-5634-4efc-a969-6c9a9e73ad17","upgrades":1,"rarity":"COMMON","has_target":false}],"exhaust_pile":[],"cards_discarded_this_turn":0,"times_damaged":0,"monsters":[{"is_gone":false,"move_hits":1,"move_base_damage":12,"half_dead":false,"move_adjusted_damage":15,"max_hp":48,"intent":"ATTACK","move_id":1,"name":"Slaver","current_hp":41,"block":0,"id":"SlaverBlue","powers":[{"amount":3,"name":"Strength","id":"Strength"},{"amount":1,"just_applied":false,"name":"Vulnerable","id":"Vulnerable"}]},{"is_gone":false,"move_hits":1,"move_base_damage":7,"half_dead":false,"move_adjusted_damage":10,"max_hp":58,"intent":"ATTACK_DEBUFF","move_id":2,"name":"Taskmaster","current_hp":51,"block":0,"id":"SlaverBoss","powers":[{"amount":3,"name":"Strength","id":"Strength"},{"amount":1,"just_applied":false,"name":"Vulnerable","id":"Vulnerable"}]},{"is_gone":false,"move_hits":1,"move_base_damage":13,"half_dead":false,"move_adjusted_damage":16,"max_hp":49,"intent":"ATTACK","move_id":1,"name":"Slaver","current_hp":42,"block":0,"id":"SlaverRed","powers":[{"amount":3,"name":"Strength","id":"Strength"},{"amount":1,"just_applied":false,"name":"Vulnerable","id":"Vulnerable"}]}],"turn":1,"limbo":[],"hand":[{"exhausts":false,"is_playable":false,"cost":3,"name":"Defend","id":"Defend_R","type":"SKILL","ethereal":false,"uuid":"4239968f-4f2e-49fa-b2f3-c5b445b7f89a","upgrades":0,"rarity":"BASIC","has_target":false},{"exhausts":false,"is_playable":false,"cost":-2,"name":"Shame","id":"Shame","type":"CURSE","ethereal":false,"uuid":"352205d0-b5c0-416c-b40d-874e64b68cca","upgrades":0,"rarity":"CURSE","has_target":false},{"exhausts":false,"is_playable":true,"cost":-1,"name":"Whirlwind+","id":"Whirlwind","type":"ATTACK","ethereal":false,"uuid":"99a281e8-18c8-4daa-9136-93c360af40af","upgrades":1,"rarity":"UNCOMMON","has_target":false},{"exhausts":false,"is_playable":false,"cost":3,"name":"Strike","id":"Strike_R","type":"ATTACK","ethereal":false,"uuid":"17c80cde-2064-486f-9c06-2a81f528b895","upgrades":0,"rarity":"BASIC","has_target":true},{"exhausts":false,"is_playable":true,"cost":2,"name":"Strike","id":"Strike_R","type":"ATTACK","ethereal":false,"uuid":"adc6fb01-4e9f-4324-884b-6d925e7a2210","upgrades":0,"rarity":"BASIC","has_target":true}],"player":{"orbs":[],"current_hp":77,"block":27,"max_hp":84,"powers":[{"amount":-1,"name":"Confusion","id":"Confusion"}],"energy":2}},"deck":[{"exhausts":false,"is_playable":true,"cost":1,"name":"Strike","id":"Strike_R","type":"ATTACK","ethereal":false,"uuid":"adc6fb01-4e9f-4324-884b-6d925e7a2210","upgrades":0,"rarity":"BASIC","has_target":true},{"exhausts":false,"is_playable":true,"cost":1,"name":"Strike","id":"Strike_R","type":"ATTACK","ethereal":false,"uuid":"0981fa04-8e90-4c41-a7c0-99ebff263a4e","upgrades":0,"rarity":"BASIC","has_target":true},{"exhausts":false,"is_playable":true,"cost":1,"name":"Strike","id":"Strike_R","type":"ATTACK","ethereal":false,"uuid":"6233c009-ddcc-44a9-8065-620bdfc6691d","upgrades":0,"rarity":"BASIC","has_target":true},{"exhausts":false,"is_playable":true,"cost":1,"name":"Strike","id":"Strike_R","type":"ATTACK","ethereal":false,"uuid":"17c80cde-2064-486f-9c06-2a81f528b895","upgrades":0,"rarity":"BASIC","has_target":true},{"exhausts":false,"is_playable":true,"cost":1,"name":"Strike","id":"Strike_R","type":"ATTACK","ethereal":false,"uuid":"4dc838ae-dc4e-47ed-9604-04b0e755cd26","upgrades":0,"rarity":"BASIC","has_target":true},{"exhausts":false,"is_playable":true,"cost":1,"name":"Defend","id":"Defend_R","type":"SKILL","ethereal":false,"uuid":"9032621c-04d4-4180-be5e-dacc27f92c76","upgrades":0,"rarity":"BASIC","has_target":false},{"exhausts":false,"is_playable":true,"cost":1,"name":"Defend","id":"Defend_R","type":"SKILL","ethereal":false,"uuid":"4239968f-4f2e-49fa-b2f3-c5b445b7f89a","upgrades":0,"rarity":"BASIC","has_target":false},{"exhausts":false,"is_playable":true,"cost":1,"name":"Defend","id":"Defend_R","type":"SKILL","ethereal":false,"uuid":"9a1eac19-8262-411e-ae73-433ecf2e6050","upgrades":0,"rarity":"BASIC","has_target":false},{"exhausts":false,"is_playable":true,"cost":2,"name":"Bash","id":"Bash","type":"ATTACK","ethereal":false,"uuid":"fb455e09-94b8-4a48-89f8-1a7f0593a58f","upgrades":0,"rarity":"BASIC","has_target":true},{"exhausts":false,"is_playable":true,"cost":2,"name":"Perfected Strike+","id":"Perfected Strike","type":"ATTACK","ethereal":false,"uuid":"3ecded1e-efbd-4cc8-9f6c-bb5d1640c6b6","upgrades":1,"rarity":"COMMON","has_target":true},{"exhausts":false,"is_playable":true,"cost":0,"name":"Flex","id":"Flex","type":"SKILL","ethereal":false,"uuid":"09dd7f6f-7c59-41be-9617-f063698d81ad","upgrades":0,"rarity":"COMMON","has_target":false},{"exhausts":false,"is_playable":true,"cost":1,"name":"Thunderclap+","id":"Thunderclap","type":"ATTACK","ethereal":false,"uuid":"dcb90d78-5634-4efc-a969-6c9a9e73ad17","upgrades":1,"rarity":"COMMON","has_target":false},{"exhausts":false,"is_playable":true,"cost":2,"name":"Perfected Strike+","id":"Perfected Strike","type":"ATTACK","ethereal":false,"uuid":"f021babd-f14c-4093-9acd-7a4a384dbf61","upgrades":1,"rarity":"COMMON","has_target":true},{"exhausts":false,"is_playable":true,"cost":1,"name":"Shrug It Off+","id":"Shrug It Off","type":"SKILL","ethereal":false,"uuid":"e072eb0e-1f44-47a8-af06-b2a4e34cdf4e","upgrades":1,"rarity":"COMMON","has_target":false},{"exhausts":false,"is_playable":true,"cost":1,"name":"Shrug It Off+","id":"Shrug It Off","type":"SKILL","ethereal":false,"uuid":"e00eb1e0-d047-44a0-91f5-062ba1f15b3d","upgrades":1,"rarity":"COMMON","has_target":false},{"exhausts":false,"is_playable":true,"cost":-1,"name":"Whirlwind+","id":"Whirlwind","type":"ATTACK","ethereal":false,"uuid":"99a281e8-18c8-4daa-9136-93c360af40af","upgrades":1,"rarity":"UNCOMMON","has_target":false},{"exhausts":false,"is_playable":true,"cost":0,"name":"Flash of Steel+","id":"Flash of Steel","type":"ATTACK","ethereal":false,"uuid":"13d589dc-090c-4424-834c-6c35ba48dd2a","upgrades":1,"rarity":"UNCOMMON","has_target":true},{"exhausts":false,"is_playable":false,"cost":-2,"name":"Shame","id":"Shame","type":"CURSE","ethereal":false,"uuid":"352205d0-b5c0-416c-b40d-874e64b68cca","upgrades":0,"rarity":"CURSE","has_target":false}],"relics":[{"name":"Burning Blood","id":"Burning Blood","counter":-1},{"name":"Neow\u0027s Lament","id":"NeowsBlessing","counter":-2},{"name":"Gremlin Horn","id":"Gremlin Horn","counter":-1},{"name":"Singing Bowl","id":"Singing Bowl","counter":-1},{"name":"Snecko Eye","id":"Snecko Eye","counter":-1},{"name":"Girya","id":"Girya","counter":0},{"name":"The Boot","id":"Boot","counter":-1},{"name":"Toy Ornithopter","id":"Toy Ornithopter","counter":-1},{"name":"Unceasing Top","id":"Unceasing Top","counter":-1}],"max_hp":84,"act_boss":"Champ","gold":26,"action_phase":"WAITING_ON_USER","act":2,"screen_name":"NONE","room_phase":"COMBAT","is_screen_up":false,"potions":[{"requires_target":true,"can_use":true,"can_discard":true,"name":"Fear Potion","id":"FearPotion"},{"requires_target":false,"can_use":false,"can_discard":false,"name":"Potion Slot","id":"Potion Slot"},{"requires_target":false,"can_use":false,"can_discard":false,"name":"Potion Slot","id":"Potion Slot"}],"current_hp":77,"floor":30,"ascension_level":0,"class":"IRONCLAD","map":[{"symbol":"M","children":[{"x":1,"y":1}],"x":0,"y":0,"parents":[]},{"symbol":"M","children":[{"x":2,"y":1}],"x":3,"y":0,"parents":[]},{"symbol":"M","children":[{"x":5,"y":1}],"x":5,"y":0,"parents":[]},{"symbol":"M","children":[{"x":6,"y":1}],"x":6,"y":0,"parents":[]},{"symbol":"?","children":[{"x":0,"y":2},{"x":1,"y":2}],"x":1,"y":1,"parents":[]},{"symbol":"?","children":[{"x":1,"y":2}],"x":2,"y":1,"parents":[]},{"symbol":"?","children":[{"x":5,"y":2}],"x":5,"y":1,"parents":[]},{"symbol":"?","children":[{"x":6,"y":2}],"x":6,"y":1,"parents":[]},{"symbol":"M","children":[{"x":1,"y":3}],"x":0,"y":2,"parents":[]},{"symbol":"?","children":[{"x":1,"y":3},{"x":2,"y":3}],"x":1,"y":2,"parents":[]},{"symbol":"M","children":[{"x":4,"y":3}],"x":5,"y":2,"parents":[]},{"symbol":"?","children":[{"x":6,"y":3}],"x":6,"y":2,"parents":[]},{"symbol":"M","children":[{"x":1,"y":4},{"x":2,"y":4}],"x":1,"y":3,"parents":[]},{"symbol":"?","children":[{"x":2,"y":4}],"x":2,"y":3,"parents":[]},{"symbol":"?","children":[{"x":4,"y":4}],"x":4,"y":3,"parents":[]},{"symbol":"$","children":[{"x":5,"y":4}],"x":6,"y":3,"parents":[]},{"symbol":"$","children":[{"x":0,"y":5},{"x":2,"y":5}],"x":1,"y":4,"parents":[]},{"symbol":"M","children":[{"x":2,"y":5},{"x":3,"y":5}],"x":2,"y":4,"parents":[]},{"symbol":"M","children":[{"x":3,"y":5}],"x":4,"y":4,"parents":[]},{"symbol":"M","children":[{"x":5,"y":5}],"x":5,"y":4,"parents":[]},{"symbol":"E","children":[{"x":1,"y":6}],"x":0,"y":5,"parents":[]},{"symbol":"R","children":[{"x":1,"y":6},{"x":2,"y":6}],"x":2,"y":5,"parents":[]},{"symbol":"E","children":[{"x":3,"y":6},{"x":4,"y":6}],"x":3,"y":5,"parents":[]},{"symbol":"R","children":[{"x":6,"y":6}],"x":5,"y":5,"parents":[]},{"symbol":"$","children":[{"x":0,"y":7}],"x":1,"y":6,"parents":[]},{"symbol":"M","children":[{"x":1,"y":7}],"x":2,"y":6,"parents":[]},{"symbol":"M","children":[{"x":4,"y":7}],"x":3,"y":6,"parents":[]},{"symbol":"R","children":[{"x":4,"y":7}],"x":4,"y":6,"parents":[]},{"symbol":"M","children":[{"x":6,"y":7}],"x":6,"y":6,"parents":[]},{"symbol":"M","children":[{"x":0,"y":8},{"x":1,"y":8}],"x":0,"y":7,"parents":[]},{"symbol":"?","children":[{"x":1,"y":8}],"x":1,"y":7,"parents":[]},{"symbol":"M","children":[{"x":3,"y":8}],"x":4,"y":7,"parents":[]},{"symbol":"R","children":[{"x":5,"y":8}],"x":6,"y":7,"parents":[]},{"symbol":"T","children":[{"x":0,"y":9}],"x":0,"y":8,"parents":[]},{"symbol":"T","children":[{"x":0,"y":9},{"x":1,"y":9}],"x":1,"y":8,"parents":[]},{"symbol":"T","children":[{"x":2,"y":9},{"x":3,"y":9}],"x":3,"y":8,"parents":[]},{"symbol":"T","children":[{"x":5,"y":9}],"x":5,"y":8,"parents":[]},{"symbol":"M","children":[{"x":0,"y":10}],"x":0,"y":9,"parents":[]},{"symbol":"R","children":[{"x":0,"y":10}],"x":1,"y":9,"parents":[]},{"symbol":"M","children":[{"x":2,"y":10}],"x":2,"y":9,"parents":[]},{"symbol":"?","children":[{"x":2,"y":10}],"x":3,"y":9,"parents":[]},{"symbol":"M","children":[{"x":4,"y":10}],"x":5,"y":9,"parents":[]},{"symbol":"?","children":[{"x":0,"y":11},{"x":1,"y":11}],"x":0,"y":10,"parents":[]},{"symbol":"M","children":[{"x":3,"y":11}],"x":2,"y":10,"parents":[]},{"symbol":"M","children":[{"x":5,"y":11}],"x":4,"y":10,"parents":[]},{"symbol":"M","children":[{"x":0,"y":12}],"x":0,"y":11,"parents":[]},{"symbol":"R","children":[{"x":1,"y":12},{"x":2,"y":12}],"x":1,"y":11,"parents":[]},{"symbol":"?","children":[{"x":2,"y":12},{"x":3,"y":12}],"x":3,"y":11,"parents":[]},{"symbol":"?","children":[{"x":5,"y":12}],"x":5,"y":11,"parents":[]},{"symbol":"E","children":[{"x":1,"y":13}],"x":0,"y":12,"parents":[]},{"symbol":"E","children":[{"x":1,"y":13}],"x":1,"y":12,"parents":[]},{"symbol":"M","children":[{"x":2,"y":13},{"x":3,"y":13}],"x":2,"y":12,"parents":[]},{"symbol":"E","children":[{"x":3,"y":13}],"x":3,"y":12,"parents":[]},{"symbol":"M","children":[{"x":6,"y":13}],"x":5,"y":12,"parents":[]},{"symbol":"M","children":[{"x":1,"y":14},{"x":2,"y":14}],"x":1,"y":13,"parents":[]},{"symbol":"M","children":[{"x":3,"y":14}],"x":2,"y":13,"parents":[]},{"symbol":"M","children":[{"x":3,"y":14}],"x":3,"y":13,"parents":[]},{"symbol":"M","children":[{"x":6,"y":14}],"x":6,"y":13,"parents":[]},{"symbol":"R","children":[{"x":3,"y":16}],"x":1,"y":14,"parents":[]},{"symbol":"R","children":[{"x":3,"y":16}],"x":2,"y":14,"parents":[]},{"symbol":"R","children":[{"x":3,"y":16}],"x":3,"y":14,"parents":[]},{"symbol":"R","children":[{"x":3,"y":16}],"x":6,"y":14,"parents":[]}],"room_type":"MonsterRoomElite"}}
"""

import json
game_state = json.loads(game_string)

print(game_state)

gc = sts.GameContext()

gc.init_from_json(game_string)
print(gc)
agent = sts.Agent()

agent.print_actions = True
agent.print_logs = True

if "combat_state" in game_state["game_state"]:
    bc = sts.BattleContext()
    bc.init_from_json(gc, json.dumps(game_state["game_state"]["combat_state"]))
    print(bc)
    agent.playout_battle(bc)
    bc.exit_battle(gc)

# gc.skip_battles = True

agent.playout(gc)
